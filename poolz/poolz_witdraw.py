# -*- coding: utf-8 -*-
"""
Created on Thu Jan 27 00:40:42 2022

@author: arsko
"""

from web3 import Web3
 
bsc="https://bsc-dataseed.binance.org/"
web3 = Web3(Web3.HTTPProvider(bsc))
print(web3.isConnected())

pool_id = 67630  # Pool id to withdraw from (dynamic)
sender_address = "" #My own address 
private=""  #private key
 
#Contract adress
router_address = "0x8BfAA473a899439d8E07BF86a8C6cE5De42fE54B"
abi = '[{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"PoolId","type":"uint256"},{"indexed":false,"internalType":"address","name":"Token","type":"address"},{"indexed":false,"internalType":"uint64","name":"FinishTime","type":"uint64"},{"indexed":false,"internalType":"uint256","name":"StartAmount","type":"uint256"},{"indexed":false,"internalType":"address","name":"Owner","type":"address"}],"name":"NewPoolCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"PoolId","type":"uint256"},{"indexed":false,"internalType":"address","name":"Spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"Amount","type":"uint256"}],"name":"PoolApproval","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"PoolId","type":"uint256"},{"indexed":false,"internalType":"address","name":"NewOwner","type":"address"},{"indexed":false,"internalType":"address","name":"OldOwner","type":"address"}],"name":"PoolOwnershipTransfered","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"Amount","type":"uint256"},{"indexed":false,"internalType":"address","name":"From","type":"address"},{"indexed":false,"internalType":"address","name":"Token","type":"address"}],"name":"TransferIn","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"Amount","type":"uint256"},{"indexed":false,"internalType":"address","name":"From","type":"address"}],"name":"TransferInETH","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"Amount","type":"uint256"},{"indexed":false,"internalType":"address","name":"To","type":"address"},{"indexed":false,"internalType":"address","name":"Token","type":"address"}],"name":"TransferOut","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"Amount","type":"uint256"},{"indexed":false,"internalType":"address","name":"To","type":"address"}],"name":"TransferOutETH","type":"event"},{"inputs":[{"internalType":"uint256","name":"_PoolId","type":"uint256"},{"internalType":"uint256","name":"_Amount","type":"uint256"},{"internalType":"address","name":"_Spender","type":"address"}],"name":"ApproveAllowance","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_Token","type":"address"},{"internalType":"uint64[]","name":"_FinishTime","type":"uint64[]"},{"internalType":"uint256[]","name":"_StartAmount","type":"uint256[]"},{"internalType":"address[]","name":"_Owner","type":"address[]"}],"name":"CreateMassPools","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_Token","type":"address"},{"internalType":"uint64","name":"_FinishTime","type":"uint64"},{"internalType":"uint256","name":"_StartAmount","type":"uint256"},{"internalType":"address","name":"_Owner","type":"address"}],"name":"CreateNewPool","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_Token","type":"address"},{"internalType":"uint64[]","name":"_FinishTime","type":"uint64[]"},{"internalType":"uint256[]","name":"_StartAmount","type":"uint256[]"},{"internalType":"address[]","name":"_Owner","type":"address[]"}],"name":"CreatePoolsWrtTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"GetFee","outputs":[{"internalType":"uint16","name":"","type":"uint16"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"GetMinDuration","outputs":[{"internalType":"uint16","name":"","type":"uint16"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"GetMyPoolsId","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_PoolId","type":"uint256"},{"internalType":"address","name":"_Address","type":"address"}],"name":"GetPoolAllowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_id","type":"uint256"}],"name":"GetPoolData","outputs":[{"internalType":"uint64","name":"","type":"uint64"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"GovernerContract","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"IsPayble","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"PozFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"PozTimer","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint16","name":"_fee","type":"uint16"}],"name":"SetFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint16","name":"_minDuration","type":"uint16"}],"name":"SetMinDuration","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint16","name":"_fee","type":"uint16"}],"name":"SetPOZFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_pozTimer","type":"uint256"}],"name":"SetPozTimer","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_PoolId","type":"uint256"},{"internalType":"uint256","name":"_NewAmount","type":"uint256"},{"internalType":"address","name":"_NewOwner","type":"address"}],"name":"SplitPoolAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_PoolId","type":"uint256"},{"internalType":"uint256","name":"_Amount","type":"uint256"},{"internalType":"address","name":"_Address","type":"address"}],"name":"SplitPoolAmountFrom","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"SwitchIsPayble","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_PoolId","type":"uint256"},{"internalType":"address","name":"_NewOwner","type":"address"}],"name":"TransferPoolOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"WhiteListId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"WhiteList_Address","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_Token","type":"address"},{"internalType":"address","name":"_to","type":"address"}],"name":"WithdrawERC20Fee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address payable","name":"_to","type":"address"}],"name":"WithdrawETHFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_PoolId","type":"uint256"}],"name":"WithdrawToken","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"isTokenFilterOn","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_tokenAddress","type":"address"}],"name":"isTokenWhiteListed","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"maxTransactionLimit","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_address","type":"address"}],"name":"setGovernerContract","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newLimit","type":"uint256"}],"name":"setMaxTransactionLimit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_address","type":"address"}],"name":"setWhiteListAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_id","type":"uint256"}],"name":"setWhiteListId","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"swapTokenFilter","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}]'
#Setup contract
contract = web3.eth.contract(address=router_address, abi=abi)

#get transaction number
nonce = web3.eth.get_transaction_count(sender_address)
poolz_txn = contract.functions.WithdrawToken(
       pool_id,
     ).buildTransaction({
       'from': sender_address,
       'gasPrice': web3.toWei('5','gwei'),
       'nonce': nonce,
     })        
signed_txn = web3.eth.account.sign_transaction(poolz_txn, private_key=private)
tx_token = web3.eth.send_raw_transaction(signed_txn.rawTransaction)
print(web3.toHex(tx_token))